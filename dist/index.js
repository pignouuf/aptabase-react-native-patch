"use strict";var g=Object.defineProperty;var x=Object.getOwnPropertyDescriptor;var N=Object.getOwnPropertyNames;var w=Object.prototype.hasOwnProperty;var k=(r,e)=>{for(var t in e)g(r,t,{get:e[t],enumerable:!0})},H=(r,e,t,s)=>{if(e&&typeof e=="object"||typeof e=="function")for(let n of N(e))!w.call(r,n)&&n!==t&&g(r,n,{get:()=>e[n],enumerable:!(s=x(e,n))||s.enumerable});return r};var U=r=>H(g({},"__esModule",{value:!0}),r);var L={};k(L,{AptabaseProvider:()=>O,init:()=>f,trackEvent:()=>h,useAptabase:()=>P});module.exports=U(L);var i=require("react-native");var S=require("react-native"),{RNAptabaseModule:c}=S.NativeModules,D={appVersion:c&&c.appVersion,appBuildNumber:c&&c.appBuildNumber},_=D;var $="aptabase-reactnative@0.3.0";function A(){let[r,e]=B(),t="en-US";return{appVersion:_.appVersion||"",appBuildNumber:_.appBuildNumber||"",isDebug:__DEV__,locale:t,osName:r,osVersion:e,sdkVersion:$}}function B(){switch(i.Platform.OS){case"android":return["Android",i.Platform.Version.toString()];case"ios":return i.Platform.isPad?["iPadOS",i.Platform.Version]:["iOS",i.Platform.Version];default:return["",""]}}var l=require("react-native");var m=class{_events=[];MAX_BATCH_SIZE=25;headers;apiUrl;constructor(e,t,s){this.apiUrl=`${t}/api/v0/events`,this.headers=new Headers({"Content-Type":"application/json","App-Key":e,"User-Agent":`${s.osName}/${s.osVersion} ${s.locale}`})}enqueue(e){if(Array.isArray(e)){this._events.push(...e);return}this._events.push(e)}async flush(){if(this._events.length===0)return Promise.resolve();let e=[];do{let t=this._events.splice(0,this.MAX_BATCH_SIZE);try{await this._sendEvents(t)}catch{e=[...e,...t]}}while(this._events.length>0);e.length>0&&this.enqueue(e)}async _sendEvents(e){try{let t=await fetch(this.apiUrl,{method:"POST",headers:this.headers,credentials:"omit",body:JSON.stringify(e)});if(t.status<300)return Promise.resolve();let s=`${t.status} ${await t.text()}`;if(t.status<500)return console.warn(`Aptabase: Failed to send ${e.length} events because of ${s}. Will not retry.`),Promise.resolve();throw new Error(s)}catch(t){throw console.error(`Aptabase: Failed to send ${e.length} events. Reason: ${t}`),t}}};function E(){return[a(8),a(4),a(4),a(4),a(12)].join("-")}var y="abcdefghijklmnopqrstuvwxyz0123456789",C=y.length;function a(r){let e="";for(let t=0;t<r;t++)e+=y.charAt(Math.floor(Math.random()*C));return e}var I=__DEV__?2e3:6e4,p={US:"https://us.aptabase.com",EU:"https://eu.aptabase.com",DEV:"http://localhost:3000",SH:""};var d=class{_dispatcher;_env;_sessionId=E();_lastTouched=new Date;_flushTimer;constructor(e,t,s){let[n,u]=e.split("-"),b=this.getBaseUrl(u,s);this._env={...t},s?.appVersion&&(this._env.appVersion=s.appVersion),this._dispatcher=new m(e,b,t)}trackEvent(e,t){this._dispatcher.enqueue({timestamp:new Date().toISOString(),sessionId:this.evalSessionId(),eventName:e,systemProps:{isDebug:this._env.isDebug,locale:this._env.locale,osName:this._env.osName,osVersion:this._env.osVersion,appVersion:this._env.appVersion,appBuildNumber:"1",sdkVersion:this._env.sdkVersion},props:t})}startPolling(e){this.stopPolling(),this._flushTimer=setInterval(this.flush.bind(this),e)}stopPolling(){this._flushTimer&&(clearInterval(this._flushTimer),this._flushTimer=void 0)}flush(){return this._dispatcher.flush()}evalSessionId(){let e=new Date;return e.getTime()-this._lastTouched.getTime()>36e5&&(this._sessionId=E()),this._lastTouched=e,this._sessionId}getBaseUrl(e,t){return e==="SH"?t?.host??p.DEV:p[e]}};function V(r,e,t){if(r!=="android"&&r!=="ios")return[!1,"This SDK is only supported on Android and iOS."];let s=e.split("-");return s.length!==3||p[s[1]]===void 0?[!1,`App Key "${e}" is invalid`]:s[1]==="SH"&&!t?.host?[!1,"Host parameter must be defined when using Self-Hosted App Key."]:[!0,""]}var o;function f(r,e){let[t,s]=V(l.Platform.OS,r,e);if(!t){console.warn(`Aptabase: ${s}. Tracking will be disabled.`);return}let n=A();o=new d(r,n,e);let u=e?.flushInterval??I;o.startPolling(u),l.AppState.isAvailable&&l.AppState.addEventListener("change",b=>{switch(o?.stopPolling(),b){case"active":o?.startPolling(u);break;case"background":o?.flush();break}})}function h(r,e){o?.trackEvent(r,e)}var v=require("react"),T=require("react/jsx-runtime"),R=(0,v.createContext)({});function O({appKey:r,options:e,children:t}){return(0,v.useEffect)(()=>{f(r,e)},[r,e]),(0,T.jsx)(R.Provider,{value:{},children:t})}function P(){return{trackEvent:h}}0&&(module.exports={AptabaseProvider,init,trackEvent,useAptabase});
//# sourceMappingURL=index.js.map